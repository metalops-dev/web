---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Comments from "../components/Comments.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import Header from "../components/Header.astro";
import DraftBanner from "../components/mdx/DraftBanner.astro";
import Newsletter from "../components/Newsletter.astro";
import PostNavigation from "../components/PostNavigation.astro";
import ReadingTime from "../components/ReadingTime.astro";
import TableOfContents from "../components/TableOfContents.astro";
import Tags from "../components/Tags.astro";

interface Heading {
	depth: number;
	slug: string;
	text: string;
}

interface PostLink {
	title: string;
	slug: string;
}

interface Props {
	title: string;
	description: string;
	pubDate: Date;
	updatedDate?: Date;
	tags?: string[];
	headings?: Heading[];
	content?: string;
	prev?: PostLink;
	next?: PostLink;
	draft?: boolean;
}

const {
	title,
	description,
	pubDate,
	updatedDate,
	tags = [],
	headings = [],
	content = "",
	prev,
	next,
	draft = false,
} = Astro.props;

const isDev = !import.meta.env.PROD;

// Calculate word count
const wordCount = content.trim().split(/\s+/).length;
const wordCountDisplay =
	wordCount > 0 ? `${wordCount.toLocaleString()} words` : "";
---

<html lang="en">
	<head>
		<BaseHead
			title={title}
			description={description}
			type="article"
			publishedTime={pubDate}
			modifiedTime={updatedDate}
			tags={tags}
		/>
	</head>

	<body>
		<Header />
		<TableOfContents headings={headings} />
		<main>
			<article>
				{draft && <DraftBanner />}
				<header class="post-header">
					<div class="meta">
						<FormattedDate date={pubDate} />
						{updatedDate && (
							<span class="updated">
								· updated <FormattedDate date={updatedDate} />
							</span>
						)}
						<span class="sep">·</span>
						<ReadingTime content={content} />
						<span class="sep">·</span>
						<span class="word-count">{wordCountDisplay}</span>
					</div>
					<h1>{title}</h1>
					<Tags tags={tags} />
				</header>

				<div class="prose">
					<slot />
				</div>
			</article>

			<Newsletter />
			<Comments />
			<PostNavigation prev={prev} next={next} />
		</main>
		<Footer />
	</body>
</html>

<style>
	.post-header {
		margin-bottom: 2rem;
	}
	.post-header h1 {
		margin-top: 0.5rem;
		margin-bottom: 0.5rem;
	}
	.meta {
		font-size: 0.9rem;
		color: var(--muted);
	}
	.sep {
		margin: 0 0.25rem;
	}
	.updated {
		font-style: italic;
	}
	.prose {
		color: var(--fg);
	}
</style>
